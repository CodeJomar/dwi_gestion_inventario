<div th:fragment="modal-agregar-producto">

    <div id="add-product-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
         th:style="${abrirModal} ? 'display: flex;' : 'display: none;'">
        <div class="bg-card p-6 rounded-lg shadow-lg w-full max-w-md mx-4">
            <div class="flex justify-between items-center mb-4">

                <h2 class="text-xl font-semibold text-foreground"
                    th:text="${isEditMode ? 'Editar Producto' : 'Agregar Producto'}">
                    Agregar Producto
                </h2>

                <button id="close-modal-btn" class="text-muted-foreground hover:text-foreground">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none"
                         stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>

            <form id="add-product-form" class="space-y-4"
                  th:action="${isEditMode ? '/auth/productos/editar' : '/auth/productos/crear'}"
                  th:object="${productoForm}"
                  method="post"
                  enctype="multipart/form-data">

                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                <input type="hidden" th:if="${isEditMode}" th:field="*{id}"/>

                <div>
                    <label for="product-name" class="block text-sm font-medium text-foreground mb-1">Nombre</label>
                    <input type="text" id="product-name" class="input w-full" th:field="*{nombre}">
                    <p th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}"
                       class="text-red-500 text-xs mt-1"></p>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <label for="product-category"
                               class="block text-sm font-medium text-foreground mb-1">Categoría</label>
                        <select id="product-category" class="input w-full" th:field="*{categoria}">
                            <option value="">Seleccionar categoría</option>
                            <option th:each="cat : ${categorias}"
                                    th:value="${cat}"
                                    th:text="${cat.displayName}"></option>
                        </select>
                        <p th:if="${#fields.hasErrors('categoria')}" th:errors="*{categoria}"
                           class="text-red-500 text-xs mt-1"></p>
                    </div>

                    <div>
                        <label for="product-status"
                               class="block text-sm font-medium text-foreground mb-1">Estado</label>

                        <select th:if="${isEditMode}" id="product-status" class="input w-full" th:field="*{estado}">
                            <option th:each="est : ${estados}"
                                    th:value="${est}"
                                    th:text="${est.displayName}"></option>
                        </select>

                        <input th:if="${!isEditMode}" type="text" value="Activo"
                               class="input w-full bg-gray-100 cursor-not-allowed" disabled />

                        <input th:if="${!isEditMode}" type="hidden" th:field="*{estado}" value="ACTIVO" />

                        <p th:if="${#fields.hasErrors('estado')}" th:errors="*{estado}"
                           class="text-red-500 text-xs mt-1"></p>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div>
                        <label for="product-price" class="block text-sm font-medium text-foreground mb-1">Precio</label>
                        <input type="number" id="product-price" step="0.01" class="input w-full" th:field="*{precio}">
                        <p th:if="${#fields.hasErrors('precio')}" th:errors="*{precio}"
                           class="text-red-500 text-xs mt-1"></p>
                    </div>
                    <div>
                        <label for="product-stock" class="block text-sm font-medium text-foreground mb-1">Stock</label>
                        <input type="number" id="product-stock" class="input w-full" th:field="*{stock}">
                        <p th:if="${#fields.hasErrors('stock')}" th:errors="*{stock}"
                           class="text-red-500 text-xs mt-1"></p>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-foreground mb-1">
                        <span th:text="${isEditMode ? 'Cambiar Imagen (Opcional)' : 'Imagen del Producto'}"></span>
                    </label>
                    <div class="file-upload-area" id="file-upload-area">
                        <input type="file" id="product-image" name="imageFile" accept="image/*" class="sr-only"/>
                        <div class="flex flex-col items-center justify-center py-6 text-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none"
                                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                 class="h-8 w-8 text-muted-foreground mb-2">
                                <path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"></path>
                                <path d="M12 12v6"></path>
                                <path d="m15 15-3 3-3-3"></path>
                            </svg>
                            <p class="text-sm text-muted-foreground">Arrastra o haz clic para seleccionar</p>
                            <p class="text-xs text-muted-foreground mt-1">PNG, JPG, GIF (Máx. 5MB)</p>
                        </div>
                    </div>
                    <p id="file-name-display" class="text-xs text-muted-foreground mt-2"></p>

                    <div th:if="${isEditMode and productoForm.imagen != null}"
                         class="mt-2 text-xs text-muted-foreground">
                        Imagen actual: <a th:href="*{imagen}" th:text="*{imagen}" target="_blank"
                                          class="text-primary hover:underline"></a>
                    </div>
                </div>

                <div class="flex gap-2 pt-4">
                    <button type="button" id="cancel-btn" class="btn btn-outline flex-1">Cancelar</button>
                    <button type="submit" class="btn btn-primary flex-1"
                            th:text="${isEditMode ? 'Guardar Cambios' : 'Agregar'}">
                        Agregar
                    </button>
                </div>
            </form>
        </div>
    </div>

</div>